<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana ç™»å½•æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #0a0a0a;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .test-container {
            max-width: 800px;
            width: 100%;
            background-color: #111111;
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid #333;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #1a1a1a;
            border-radius: 0.75rem;
            border: 1px solid #333;
        }

        .test-section h3 {
            color: #10b981;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .test-button {
            background-color: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .test-button.secondary {
            background-color: #4285f4;
        }

        .test-button.secondary:hover {
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
        }

        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #0f2419;
            border: 1px solid #10b981;
            border-radius: 0.5rem;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .error {
            background-color: #2a0f0f;
            border-color: #dc2626;
            color: #fca5a5;
        }

        .success {
            background-color: #0f2419;
            border-color: #10b981;
            color: #86efac;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #888;
        }

        .input-group input {
            width: 100%;
            padding: 0.75rem;
            background-color: #111111;
            border: 1px solid #333;
            border-radius: 0.5rem;
            color: #ffffff;
            font-size: 1rem;
        }

        .input-group input:focus {
            outline: none;
            border-color: #10b981;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="text-align: center; color: #10b981; margin-bottom: 2rem;">
            ğŸ§ª Nano Banana ç™»å½•æµ‹è¯•å·¥å…·
        </h1>

        <!-- ç™»å½•æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ” ç™»å½•åŠŸèƒ½æµ‹è¯•</h3>
            <p style="color: #888; margin-bottom: 1rem;">
                æµ‹è¯•ç™»å½•ã€ç§¯åˆ†æŸ¥è¯¢å’ŒAPIè®¿é—®åŠŸèƒ½
            </p>

            <div class="input-group">
                <label for="test-email">æµ‹è¯•é‚®ç®±ï¼š</label>
                <input type="email" id="test-email" placeholder="test@example.com" value="test@example.com">
            </div>

            <button class="test-button" onclick="testAnonymousUse()">ğŸ æµ‹è¯•åŒ¿åä½¿ç”¨</button>
            <button class="test-button" onclick="debugAnonymousCredits()">ğŸ”§ è°ƒè¯•åŒ¿åç§¯åˆ†</button>
            <button class="test-button secondary" onclick="testLogin()">ğŸš€ æµ‹è¯•ç™»å½•</button>
            <button class="test-button" onclick="testCredits()" style="background-color: #8b5cf6;">ğŸ’ æŸ¥è¯¢ç§¯åˆ†</button>
            <button class="test-button" onclick="testGeneration()" style="background-color: #10b981;">ğŸ¨ æµ‹è¯•ç”Ÿæˆ</button>
            <button class="test-button" onclick="testBatchGeneration()" style="background-color: #f59e0b;">ğŸ”¥ æ‰¹é‡ç”Ÿæˆæµ‹è¯•</button>
            <button class="test-button" onclick="clearResults()" style="background-color: #ef4444;">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>

            <div id="login-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- æœåŠ¡å™¨çŠ¶æ€æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸŒ æœåŠ¡å™¨çŠ¶æ€æµ‹è¯•</h3>
            <p style="color: #888; margin-bottom: 1rem;">
                æ£€æŸ¥å¼€å‘æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
            </p>

            <button class="test-button" onclick="testServerStatus()">ğŸ” æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€</button>
            <button class="test-button secondary" onclick="testAPIs()">ğŸ“Š æµ‹è¯•æ‰€æœ‰API</button>

            <div id="server-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="test-section">
            <h3>ğŸ“– æµ‹è¯•è¯´æ˜</h3>
            <div style="color: #ccc; line-height: 1.6;">
                <p><strong>ğŸ åŒ¿åç”¨æˆ·æµ‹è¯•ï¼š</strong> æ¸…é™¤ç™»å½•ä¿¡æ¯ï¼Œæ¨¡æ‹Ÿæ–°ç”¨æˆ·é¦–æ¬¡è®¿é—®ä½“éªŒ</p>
                <p><strong>1. ç™»å½•æµ‹è¯•ï¼š</strong> è¾“å…¥é‚®ç®±åç‚¹å‡»"æµ‹è¯•ç™»å½•"ï¼Œåº”è¯¥èƒ½æˆåŠŸç™»å½•å¹¶è·å¾—5ä¸ªç§¯åˆ†</p>
                <p><strong>2. ç§¯åˆ†æŸ¥è¯¢ï¼š</strong> ç‚¹å‡»"æŸ¥è¯¢ç§¯åˆ†"æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ç§¯åˆ†ä½™é¢å’Œç”¨æˆ·ç­‰çº§</p>
                <p><strong>3. ç”Ÿæˆæµ‹è¯•ï¼š</strong> æµ‹è¯•AIå›¾åƒç”ŸæˆåŠŸèƒ½ï¼ˆä¼šæ¶ˆè€—1ç§¯åˆ†ï¼Œæ”¯æŒæ‰¹é‡ç”Ÿæˆï¼‰</p>
                <p><strong>4. ğŸ”¥ æ‰¹é‡ç”Ÿæˆæµ‹è¯•ï¼š</strong> æµ‹è¯•ä»˜è´¹ç”¨æˆ·çš„ä¸“å±æ‰¹é‡ç”ŸæˆåŠŸèƒ½ï¼ˆç”Ÿæˆ3å¼ å›¾ç‰‡ï¼‰</p>
                <p><strong>5. æœåŠ¡å™¨çŠ¶æ€ï¼š</strong> æ£€æŸ¥æ‰€æœ‰APIç«¯ç‚¹æ˜¯å¦æ­£å¸¸å“åº”</p>
                <p><strong>6. æ¸…é™¤ç»“æœï¼š</strong> æ¸…é™¤æµ‹è¯•ç»“æœåŒºåŸŸçš„å†…å®¹</p>

                <div style="background-color: #0f2419; border: 1px solid #10b981; border-radius: 0.5rem; padding: 1rem; margin-top: 1rem;">
                    <p style="color: #10b981; font-weight: bold; margin-bottom: 0.5rem;">ğŸ¯ ç”¨æˆ·ä½“éªŒæµç¨‹ï¼š</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">1ï¸âƒ£ <strong>æ–°ç”¨æˆ·è®¿é—®ï¼š</strong> ç›´æ¥å¯ç”¨ï¼Œæ— éœ€ç™»å½•</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">2ï¸âƒ£ <strong>å…è´¹è¯•ç”¨ï¼š</strong> å¯ä½¿ç”¨3æ¬¡å…è´¹ç”Ÿæˆ</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">3ï¸âƒ£ <strong>ä½“éªŒåŠŸèƒ½ï¼š</strong> åªèƒ½ç”Ÿæˆ1å¼ å›¾ç‰‡</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">4ï¸âƒ£ <strong>è¯•ç”¨ç»“æŸï¼š</strong> ç¬¬4æ¬¡ä½¿ç”¨æ—¶å¼¹å‡ºç™»å½•æç¤º</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">5ï¸âƒ£ <strong>ç™»å½•æ³¨å†Œï¼š</strong> è·å¾—æ›´å¤šç§¯åˆ†å’Œé«˜çº§åŠŸèƒ½</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">6ï¸âƒ£ <strong>ä»˜è´¹å‡çº§ï¼š</strong> æ‰¹é‡ç”Ÿæˆã€ä¸“ä¸šAIå¼•æ“</p>
                </div>

                <div style="background-color: #1a1a2e; border: 1px solid #8b5cf6; border-radius: 0.5rem; padding: 1rem; margin-top: 1rem;">
                    <p style="color: #8b5cf6; font-weight: bold; margin-bottom: 0.5rem;">ğŸ”¥ åŠŸèƒ½å¯¹æ¯”ï¼š</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">â€¢ <strong>åŒ¿åç”¨æˆ·ï¼š</strong> 3æ¬¡å…è´¹è¯•ç”¨ï¼Œåªèƒ½ç”Ÿæˆ1å¼ å›¾ç‰‡</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">â€¢ <strong>æ³¨å†Œç”¨æˆ·ï¼š</strong> 5ä¸ªç§¯åˆ†ï¼Œå¯ç”Ÿæˆ2-4å¼ å›¾ç‰‡</p>
                    <p style="color: #ccc; margin: 0; font-size: 0.9rem;">â€¢ <strong>æ— é™ç‰ˆç”¨æˆ·ï¼š</strong> æ— é™åˆ¶ä½¿ç”¨ï¼Œå¯ç”Ÿæˆ2-10å¼ å›¾ç‰‡</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤ºå‡½æ•°
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = content;
            element.className = `test-result ${type}`;
        }

        // æµ‹è¯•åŒ¿åç”¨æˆ·åŠŸèƒ½
        async function testAnonymousUse() {
            try {
                showResult('login-result', 'æ­£åœ¨æµ‹è¯•åŒ¿åç”¨æˆ·åŠŸèƒ½...', 'info');

                // æ¸…é™¤å·²æœ‰çš„ç™»å½•ä¿¡æ¯æ¥æ¨¡æ‹ŸåŒ¿åç”¨æˆ·
                localStorage.removeItem('nano_user_email');
                localStorage.removeItem('nano_session_id');

                // åˆ·æ–°é¡µé¢æ¥åˆå§‹åŒ–åŒ¿åä¼šè¯
                setTimeout(() => {
                    showResult('login-result',
                        `âœ… åŒ¿åç”¨æˆ·æµ‹è¯•å‡†å¤‡å®Œæˆï¼\n\n` +
                        `ç°åœ¨å¯ä»¥è®¿é—®ä¸»é¡µé¢è¿›è¡Œæµ‹è¯•ï¼š\n` +
                        `http://localhost:3001/nano\n\n` +
                        `æ‚¨å°†çœ‹åˆ°ï¼š\n` +
                        `ğŸ å…è´¹è¯•ç”¨: 3/3 æ¬¡ (æ— éœ€ç™»å½•)\n\n` +
                        `å¯ä»¥ç›´æ¥å¼€å§‹ç”Ÿæˆå›¾ç‰‡ï¼Œæ— éœ€ç™»å½•ï¼\n` +
                        `ç¬¬4æ¬¡ä½¿ç”¨æ—¶ä¼šè‡ªåŠ¨å¼¹å‡ºç™»å½•æç¤ºã€‚`,
                        'success'
                    );
                }, 1000);

            } catch (error) {
                showResult('login-result', `âŒ åŒ¿åç”¨æˆ·æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è°ƒè¯•åŒ¿åç”¨æˆ·ç§¯åˆ†
        async function debugAnonymousCredits() {
            try {
                showResult('login-result', 'æ­£åœ¨è°ƒè¯•åŒ¿åç”¨æˆ·ç§¯åˆ†...', 'info');

                // è·å–å½“å‰çš„sessionId
                let sessionId = localStorage.getItem('nano_session_id');

                if (!sessionId) {
                    showResult('login-result',
                        `âŒ æœªæ‰¾åˆ°ä¼šè¯ID\n\n` +
                        `è¯·å…ˆç‚¹å‡»"ğŸ æµ‹è¯•åŒ¿åä½¿ç”¨"æ¥åˆå§‹åŒ–åŒ¿åä¼šè¯`,
                        'error'
                    );
                    return;
                }

                // æŸ¥è¯¢åŒ¿åç”¨æˆ·ç§¯åˆ†
                const response = await fetch(`/api/anonymous/credits?sessionId=${encodeURIComponent(sessionId)}`);
                const data = await response.json();

                if (response.ok && data.success) {
                    showResult('login-result',
                        `ğŸ”§ åŒ¿åç”¨æˆ·ç§¯åˆ†è°ƒè¯•ä¿¡æ¯ï¼š\n\n` +
                        `ä¼šè¯ID: ${sessionId}\n` +
                        `å‰©ä½™å…è´¹æ¬¡æ•°: ${data.remainingFreeUses}/3\n` +
                        `æ˜¯å¦åŒ¿å: ${data.isAnonymous ? 'æ˜¯' : 'å¦'}\n` +
                        `çŠ¶æ€: ${data.remainingFreeUses > 0 ? 'æ­£å¸¸' : 'å·²ç”¨å®Œï¼Œéœ€è¦ç™»å½•'}\n\n` +
                        `å¦‚æœå‰©ä½™æ¬¡æ•°ä¸æ˜¯3ï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°åˆå§‹åŒ–ã€‚`,
                        'success'
                    );
                } else {
                    showResult('login-result',
                        `âŒ æŸ¥è¯¢å¤±è´¥: ${data.error}\n\n` +
                        `å¯èƒ½çš„åŸå› ï¼š\n` +
                        `â€¢ æœåŠ¡å™¨é‡å¯åæ•°æ®ä¸¢å¤±\n` +
                        `â€¢ ä¼šè¯IDæ— æ•ˆ\n` +
                        `â€¢ APIç«¯ç‚¹é”™è¯¯`,
                        'error'
                    );
                }

            } catch (error) {
                showResult('login-result', `âŒ è°ƒè¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç™»å½•åŠŸèƒ½
        async function testLogin() {
            const email = document.getElementById('test-email').value;

            try {
                showResult('login-result', 'æ­£åœ¨æµ‹è¯•ç™»å½•...', 'info');

                // æ¨¡æ‹Ÿç™»å½•ï¼ˆå­˜å‚¨åˆ°localStorageï¼‰
                localStorage.setItem('nano_user_email', email);

                // æµ‹è¯•ç§¯åˆ†æŸ¥è¯¢API
                const creditsResponse = await fetch(`/api/user/credits?email=${encodeURIComponent(email)}`);
                const creditsData = await creditsResponse.json();

                if (creditsResponse.ok) {
                    showResult('login-result',
                        `âœ… ç™»å½•æˆåŠŸï¼\n` +
                        `ğŸ“§ é‚®ç®±: ${email}\n` +
                        `ğŸ’ ç§¯åˆ†: ${creditsData.credits}\n` +
                        `ğŸ”„ æ— é™åˆ¶: ${creditsData.isUnlimited ? 'æ˜¯' : 'å¦'}\n` +
                        `ğŸ•’ æ›´æ–°æ—¶é—´: ${new Date(creditsData.lastUpdated).toLocaleString()}`,
                        'success'
                    );
                } else {
                    showResult('login-result', `âŒ ç§¯åˆ†æŸ¥è¯¢å¤±è´¥: ${creditsData.error}`, 'error');
                }

            } catch (error) {
                showResult('login-result', `âŒ ç™»å½•æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç§¯åˆ†æŸ¥è¯¢
        async function testCredits() {
            const email = localStorage.getItem('nano_user_email') || document.getElementById('test-email').value;

            try {
                showResult('login-result', 'æ­£åœ¨æŸ¥è¯¢ç§¯åˆ†...', 'info');

                const response = await fetch(`/api/user/credits?email=${encodeURIComponent(email)}`);
                const data = await response.json();

                if (response.ok) {
                    showResult('login-result',
                        `ğŸ’ ç§¯åˆ†æŸ¥è¯¢ç»“æœ:\n` +
                        `ğŸ“§ ç”¨æˆ·: ${data.email || email}\n` +
                        `ğŸ’ å½“å‰ç§¯åˆ†: ${data.credits}\n` +
                        `ğŸ”„ æ— é™åˆ¶æ¨¡å¼: ${data.isUnlimited ? 'æ˜¯' : 'å¦'}\n` +
                        `ğŸ•’ æœ€åæ›´æ–°: ${new Date(data.lastUpdated).toLocaleString()}`,
                        'success'
                    );
                } else {
                    showResult('login-result', `âŒ æŸ¥è¯¢å¤±è´¥: ${data.error}`, 'error');
                }

            } catch (error) {
                showResult('login-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å›¾åƒç”Ÿæˆ
        async function testGeneration() {
            const email = localStorage.getItem('nano_user_email');

            if (!email) {
                showResult('login-result', 'âŒ è¯·å…ˆç™»å½•åå†æµ‹è¯•ç”ŸæˆåŠŸèƒ½', 'error');
                return;
            }

            try {
                showResult('login-result', 'æ­£åœ¨æµ‹è¯•å›¾åƒç”Ÿæˆ...', 'info');

                const testPrompt = 'ä¸€åªå¯çˆ±çš„å¡é€šçŒ«å’ª';
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: testPrompt,
                        email: email,
                        count: 1
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.images && data.images.length > 0) {
                        showResult('login-result',
                            `âœ… æ‰¹é‡ç”Ÿæˆæµ‹è¯•æˆåŠŸï¼\n` +
                            `ğŸ“ æç¤ºè¯: "${testPrompt}"\n` +
                            `ğŸ–¼ï¸ ç”Ÿæˆå›¾ç‰‡: ${data.totalGenerated}/${data.requestedCount} å¼ \n` +
                            `ğŸ’ å‰©ä½™ç§¯åˆ†: ${data.remainingCredits}\n` +
                            `ğŸ“Š æ¶ˆè€—ç§¯åˆ†: ${data.creditsDeducted}`,
                            'success'
                        );
                    } else {
                        showResult('login-result',
                            `âœ… å•å›¾ç”Ÿæˆæµ‹è¯•æˆåŠŸï¼\n` +
                            `ğŸ“ æç¤ºè¯: "${testPrompt}"\n` +
                            `ğŸ’ å‰©ä½™ç§¯åˆ†: ${data.remainingCredits}\n` +
                            `ğŸ“Š æ¶ˆè€—ç§¯åˆ†: ${data.creditsDeducted}`,
                            'success'
                        );
                    }
                } else {
                    showResult('login-result',
                        `âŒ ç”Ÿæˆå¤±è´¥ (${response.status}):\n` +
                        `${data.error || 'æœªçŸ¥é”™è¯¯'}`,
                        'error'
                    );
                }

            } catch (error) {
                showResult('login-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ‰¹é‡ç”Ÿæˆ
        async function testBatchGeneration() {
            const email = localStorage.getItem('nano_user_email');

            if (!email) {
                showResult('login-result', 'âŒ è¯·å…ˆç™»å½•åå†æµ‹è¯•æ‰¹é‡ç”ŸæˆåŠŸèƒ½', 'error');
                return;
            }

            try {
                showResult('login-result', 'æ­£åœ¨æµ‹è¯•æ‰¹é‡ç”Ÿæˆ (3å¼ )...', 'info');

                const testPrompt = 'ç¾ä¸½çš„å±±æ°´é£æ™¯ç”»';
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: testPrompt,
                        email: email,
                        count: 3
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showResult('login-result',
                        `ğŸ‰ æ‰¹é‡ç”Ÿæˆé«˜çº§åŠŸèƒ½æµ‹è¯•æˆåŠŸï¼\n\n` +
                        `ğŸ“ æç¤ºè¯: "${testPrompt}"\n` +
                        `ğŸ”¥ ä½¿ç”¨é«˜çº§AIå¼•æ“\n` +
                        `ğŸ–¼ï¸ ç”Ÿæˆå›¾ç‰‡: ${data.totalGenerated}/${data.requestedCount} å¼ \n` +
                        `ğŸ’ å‰©ä½™ç§¯åˆ†: ${data.remainingCredits}\n` +
                        `ğŸ“Š æ¶ˆè€—ç§¯åˆ†: ${data.creditsDeducted}\n\n` +
                        `â­ ä»˜è´¹ç”¨æˆ·ä¸“äº«åŠŸèƒ½å·²å¯ç”¨ï¼`,
                        'success'
                    );
                } else if (response.status === 402) {
                    showResult('login-result',
                        `âš ï¸ æ‰¹é‡ç”Ÿæˆéœ€è¦ä»˜è´¹ç”¨æˆ·æƒé™:\n\n` +
                        `${data.error}\n\n` +
                        `ğŸ’¡ è¯·å…ˆè´­ä¹°ä¸“ä¸šç‰ˆæˆ–æ— é™ç‰ˆå¥—é¤`,
                        'error'
                    );
                } else {
                    showResult('login-result',
                        `âŒ æ‰¹é‡ç”Ÿæˆå¤±è´¥ (${response.status}):\n` +
                        `${data.error || 'æœªçŸ¥é”™è¯¯'}`,
                        'error'
                    );
                }

            } catch (error) {
                showResult('login-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æœåŠ¡å™¨çŠ¶æ€
        async function testServerStatus() {
            try {
                showResult('server-result', 'æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...', 'info');

                // æµ‹è¯•é¦–é¡µ
                const homeResponse = await fetch('/');
                const homeStatus = homeResponse.ok ? 'âœ…' : 'âŒ';

                // æµ‹è¯•nanoé¡µé¢
                const nanoResponse = await fetch('/nano');
                const nanoStatus = nanoResponse.ok ? 'âœ…' : 'âŒ';

                // æµ‹è¯•ç§¯åˆ†API
                const creditsResponse = await fetch('/api/user/credits?email=test@example.com');
                const creditsStatus = creditsResponse.ok ? 'âœ…' : 'âŒ';

                showResult('server-result',
                    `ğŸŒ æœåŠ¡å™¨çŠ¶æ€æŠ¥å‘Š:\n\n` +
                    `ğŸ  é¦–é¡µ (/): ${homeStatus} (${homeResponse.status})\n` +
                    `ğŸ¨ Nanoé¡µé¢ (/nano): ${nanoStatus} (${nanoResponse.status})\n` +
                    `ğŸ’ ç§¯åˆ†API (/api/user/credits): ${creditsStatus} (${creditsResponse.status})\n\n` +
                    `ğŸ“¡ æœåŠ¡å™¨è¿è¡Œæ­£å¸¸ï¼Œæ‰€æœ‰ç«¯ç‚¹å“åº”æ­£å¸¸ï¼`,
                    homeResponse.ok && nanoResponse.ok && creditsResponse.ok ? 'success' : 'error'
                );

            } catch (error) {
                showResult('server-result', `âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ‰€æœ‰API
        async function testAPIs() {
            const apis = [
                { name: 'ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢', url: '/api/user/credits?email=test@example.com' },
                { name: 'Gemini API', url: '/api/gemini', method: 'POST', body: { prompt: 'test', email: 'test@example.com' } },
                { name: 'Stripeåˆ›å»ºæ”¯ä»˜', url: '/api/stripe/create-payment-intent', method: 'POST', body: { planId: 'starter', customerEmail: 'test@example.com' } },
                { name: 'Stripe Webhook', url: '/api/stripe/webhook', method: 'POST', body: { type: 'test' } }
            ];

            let results = 'ğŸ“Š APIæµ‹è¯•ç»“æœ:\n\n';

            for (const api of apis) {
                try {
                    const response = await fetch(api.url, {
                        method: api.method || 'GET',
                        headers: { 'Content-Type': 'application/json' },
                        body: api.body ? JSON.stringify(api.body) : undefined
                    });

                    const status = response.ok ? 'âœ…' : 'âŒ';
                    results += `${api.name}: ${status} (${response.status})\n`;

                } catch (error) {
                    results += `${api.name}: âŒ (ç½‘ç»œé”™è¯¯)\n`;
                }
            }

            showResult('server-result', results, 'info');
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('login-result').style.display = 'none';
            document.getElementById('server-result').style.display = 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ§ª Nano Banana æµ‹è¯•å·¥å…·å·²åŠ è½½');
            console.log('ğŸ’¡ ä½¿ç”¨è¯´æ˜: åœ¨ä¸Šæ–¹è¾“å…¥é‚®ç®±å¹¶ç‚¹å‡»æµ‹è¯•æŒ‰é’®');
        });
    </script>
</body>
</html>
